// Copyright (c) 1999 Peter Karlsson
//
// $Id$
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, version 2
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#include <string.h>

#include "charset.h"

const unsigned int c_437[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 199, 252, 233,
    226, 228, 224, 229, 231, 234, 235, 232, 239, 238, 236, 196, 197, 201,
    230, 198, 244, 246, 242, 251, 249, 255, 214, 220, 162, 163, 165, 8359,
    402, 225, 237, 243, 250, 241, 209, 170, 186, 191, 8976, 172, 189, 188,
    161, 171, 187, 9617, 9618, 9619, 9474, 9508, 9569, 9570, 9558, 9557,
    9571, 9553, 9559, 9565, 9564, 9563, 9488, 9492, 9524, 9516, 9500, 9472,
    9532, 9566, 9567, 9562, 9556, 9577, 9574, 9568, 9552, 9580, 9575, 9576,
    9572, 9573, 9561, 9560, 9554, 9555, 9579, 9578, 9496, 9484, 9608, 9604,
    9612, 9616, 9600, 945, 223, 915, 960, 931, 963, 181, 964, 934, 920,
    937, 948, 8734, 966, 949, 8745, 8801, 177, 8805, 8804, 8992, 8993, 247,
    8776, 176, 8729, 183, 8730, 8319, 178, 9632, 160
};

const unsigned int c_737[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 913, 914, 915,
    916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 929,
    931, 932, 933, 934, 935, 936, 937, 945, 946, 947, 948, 949, 950, 951,
    952, 953, 954, 955, 956, 957, 958, 959, 960, 961, 963, 962, 964, 965,
    966, 967, 968, 9617, 9618, 9619, 9474, 9508, 9569, 9570, 9558, 9557,
    9571, 9553, 9559, 9565, 9564, 9563, 9488, 9492, 9524, 9516, 9500, 9472,
    9532, 9566, 9567, 9562, 9556, 9577, 9574, 9568, 9552, 9580, 9575, 9576,
    9572, 9573, 9561, 9560, 9554, 9555, 9579, 9578, 9496, 9484, 9608, 9604,
    9612, 9616, 9600, 969, 940, 941, 942, 970, 943, 972, 973, 971, 974,
    902, 904, 905, 906, 908, 910, 911, 177, 8805, 8804, 938, 939, 247,
    8776, 176, 8729, 183, 8730, 8319, 178, 9632, 160
};

const unsigned int c_850[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 199, 252, 233,
    226, 228, 224, 229, 231, 234, 235, 232, 239, 238, 236, 196, 197, 201,
    230, 198, 244, 246, 242, 251, 249, 255, 214, 220, 248, 163, 216, 215,
    402, 225, 237, 243, 250, 241, 209, 170, 186, 191, 174, 172, 189, 188,
    161, 171, 187, 9617, 9618, 9619, 9474, 9508, 193, 194, 192, 169, 9571,
    9553, 9559, 9565, 162, 165, 9488, 9492, 9524, 9516, 9500, 9472, 9532,
    227, 195, 9562, 9556, 9577, 9574, 9568, 9552, 9580, 164, 240, 208, 202,
    203, 200, 305, 205, 206, 207, 9496, 9484, 9608, 9604, 166, 204, 9600,
    211, 223, 212, 210, 245, 213, 181, 254, 222, 218, 219, 217, 253, 221,
    175, 180, 173, 177, 8215, 190, 182, 167, 247, 184, 176, 168, 183, 185,
    179, 178, 9632, 160
};

const unsigned int c_866[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 1040, 1041,
    1042, 1043, 1044, 1045, 1046, 1047, 1048, 1049, 1050, 1051, 1052, 1053,
    1054, 1055, 1056, 1057, 1058, 1059, 1060, 1061, 1062, 1063, 1064, 1065,
    1066, 1067, 1068, 1069, 1070, 1071, 1072, 1073, 1074, 1075, 1076, 1077,
    1078, 1079, 1080, 1081, 1082, 1083, 1084, 1085, 1086, 1087, 9617, 9618,
    9619, 9474, 9508, 9569, 9570, 9558, 9557, 9571, 9553, 9559, 9565, 9564,
    9563, 9488, 9492, 9524, 9516, 9500, 9472, 9532, 9566, 9567, 9562, 9556,
    9577, 9574, 9568, 9552, 9580, 9575, 9576, 9572, 9573, 9561, 9560, 9554,
    9555, 9579, 9578, 9496, 9484, 9608, 9604, 9612, 9616, 9600, 1088, 1089,
    1090, 1091, 1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099, 1100, 1101,
    1102, 1103, 1025, 1105, 1028, 1108, 1031, 1111, 1038, 1118, 176, 8729,
    183, 8730, 8470, 164, 9632, 160
};

const unsigned int c_646_se[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 201, 65, 66,
    67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84,
    85, 86, 87, 88, 89, 90, 196, 214, 197, 220, 95, 233, 97, 98, 99, 100,
    101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114,
    115, 116, 117, 118, 119, 120, 121, 122, 228, 246, 229, 252, 127,

    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 201, 65, 66,
    67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84,
    85, 86, 87, 88, 89, 90, 196, 214, 197, 220, 95, 233, 97, 98, 99, 100,
    101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114,
    115, 116, 117, 118, 119, 120, 121, 122, 228, 246, 229, 252, 127
};

const unsigned int c_8859_1[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 199, 252, 233,
    226, 228, 224, 229, 231, 234, 235, 232, 239, 238, 236, 196, 197, 201,
    230, 198, 244, 246, 242, 251, 249, 255, 214, 220, 162, 163, 165, 8359,
    402, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172,
    173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186,
    187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200,
    201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214,
    215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228,
    229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242,
    243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255
};

const unsigned int c_atarist[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 199, 252, 233,
    226, 228, 224, 229, 231, 234, 235, 232, 239, 238, 236, 196, 197, 201,
    230, 198, 244, 246, 242, 251, 249, 255, 214, 220, 162, 163, 165, 223,
    402, 225, 237, 243, 250, 241, 209, 170, 186, 191, 8976, 172, 189, 188,
    161, 171, 187, 227, 245, 216, 248, 339, 338, 192, 195, 213, 168, 180,
    8224, 182, 169, 174, 8482, 307, 306, 1488, 1489, 1490, 1491, 1492,
    1493, 1494, 1495, 1496, 1497, 1499, 1500, 1502, 1504, 1505, 1506, 1508,
    1510, 1511, 1512, 1513, 1514, 1503, 1498, 1501, 1507, 1509, 167, 8743,
    8734, 945, 946, 915, 960, 931, 963, 181, 964, 934, 920, 937, 948, 8750,
    966, 949, 8745, 8801, 177, 8805, 8804, 8992, 8993, 247, 8776, 176,
    8729, 183, 8730, 8319, 178, 179, 175
};

const unsigned int c_macroman[] = {
    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
    68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85,
    86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102,
    103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
    117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 196, 197, 199,
    201, 209, 214, 220, 225, 224, 226, 228, 227, 229, 231, 233, 232, 234,
    235, 237, 236, 238, 239, 241, 243, 242, 244, 246, 245, 250, 249, 251,
    252, 8224, 176, 162, 163, 167, 8729, 182, 223, 174, 169, 8482, 180,
    168, 8800, 198, 216, 8734, 177, 8804, 8805, 165, 181, 8706, 8721, 8719,
    960, 8747, 170, 186, 937, 230, 248, 191, 161, 172, 8730, 402, 8776,
    916, 171, 187, 8943, 160, 192, 195, 213, 338, 339, 8211, 8212, 8220,
    8221, 8216, 8217, 247, 9674, 255, 376, 8260, 164, 8249, 8250, 64257,
    64258, 8225, 183, 8218, 8222, 8240, 194, 202, 193, 203, 200, 205, 206,
    207, 204, 211, 212, 32, 210, 218, 219, 217, 305, 770, 771, 175, 728,
    729, 730, 184, 733, 731, 711
};

// Check character set
// input: ctrlbuf - pointer to message control information
// output: pointer to translation table
const unsigned int *chrscheck(char *ctrlbuf)
{
    char *p;

    // Codepage 437 is fallback
    const unsigned int *trans = c_437;

    // Locate CHRS: control information
    p = strstr(ctrlbuf, "\x1""CHRS: ");
    if (p && *p)
    {
        p += 7;

        // Check for known character sets.
        if (0 == strncmp(p, "IBMPC", 5) ||
            0 == strncmp(p, "CP437", 5))
        {
            // "CHRS: IBMPC" may have an additional "CODEPAGE:"
            // specifier (FD*).
            p = strstr(ctrlbuf, "\x1""CODEPAGE: ");
            if (p)
            {
                p += 11;
                if (0 == strncmp(p, "850", 3)) trans = c_850;
                else trans = c_437;
            }
            else
                trans = c_437;
        }
        else if (0 == strncmp(p, "+7_FIDO", 7) ||
            0 == strncmp(p, "CP866", 5))
        {
            trans = c_866;
        }
        else if (0 == strncmp(p, "CP737", 5))
        {
            trans = c_737;
        }
        else if (0 == strncmp(p, "CP850", 5))
        {
            trans = c_850;
        }
        else if (0 == strncmp(p, "SWEDISH", 7))
        {
            trans = c_646_se;
        }
        else if (0 == strncmp(p, "LATIN-1", 7))
        {
            trans = c_8859_1;
        }
        else if (0 == strncmp(p, "MAC", 3))
        {
            trans = c_macroman;
        }
        else if (0 == strncmp(p, "ATARI", 5))
        {
            trans = c_atarist;
        }
    }

    return trans;
}
